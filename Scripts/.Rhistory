ggsave(here(plot_dir,"yield_hourly1.png"))
plotYield(sl_qual[sl_qual$streetlight%in%unique(sl_qual$streetlight)[1:4] &
sl_qual$id=="System.overview.Battery.Power.W",]) +
labs(title="Yield per hour for Nepal SL5-7: 1 Jul 2019 - 31 Mar 2020")
ggsave(here(plot_dir,"yield_hourly2.png"))
plotYield(sl_qual[sl_qual$id=="System.overview.Battery.Power.W",]) +
labs(title="Yield per hour for Nepal streetlights: 1 Jul 2019 - 31 Mar 2020")
ggsave(here(plot_dir,"yield_hourly_all.png"))
#******************************************************************************************#
# Set working directory
filepath <- "Data"
plot_dir <- "Plots/Paper 7"
#******************************************************************************************#
# Read corrected SL data and energy excess data
na_seadec_correctedData <- read.csv(here(filepath,"na_seadec_correctedData.csv"), header=TRUE, stringsAsFactors=FALSE)
na_seadec_correctedData <- na_seadec_correctedData %>%
mutate(date=as.Date(date),timestamp=as.POSIXct(timestamp, tz="GMT", origin="1970-01-01"),
month2=factor(month, levels = c("Jul", "Aug", "Sep", "Oct", "Nov", "Dec", "Jan", "Feb", "Mar"),
labels = c("Jul", "Aug", "Sep", "Oct", "Nov", "Dec", "Jan", "Feb", "Mar")))
energy_excess <- read.csv(here(filepath,"Excess elc at sockets Nepal 2.csv"), header=TRUE, stringsAsFactors=FALSE)
energy_excess <- energy_excess %>%
mutate(Time=as.POSIXct(Time, tz="GMT", origin="1970-01-01", format="%d/%m/%Y %H:%M"),
timeUse = hour(Time))
#******************************************************************************************#
# Get full data days from original data - all variables needed
system_sub_original <- na_seadec_correctedData[,c(1:3,5,7,9,11,17)]
system_sub_original <- system_sub_original[complete.cases(system_sub_original),]
onHours <- system_sub_original %>% group_by(streetlight, month2, date) %>%
summarise(hours=length(Solar.Charger.PV.power.W_original))
onHours <- as.data.frame(onHours[onHours$hours==24,])
full_days <- onHours %>% group_by(streetlight, month2) %>% summarise(days=length(date))
write.csv(full_days, file=here(filepath,"full_days_all_data_nepal.csv"), row.names=FALSE)
#******************************************************************************************#
# Get typical day values for each SL
# Subset data to get SL, Time, Potential PV, SoC, Actual PV power, Actual Socket load,
# Positive actual Solar battery power (E_a), Positive and negative actual battery power,
# Actual light load
system_sub_interpolation <- na_seadec_correctedData[,c(1,3,15,14,4,32,33,36,37,39,40,41)]
system_sub_original <- na_seadec_correctedData[,c(1,3,15,14,5,32,33,36,37,39,40,41)]
system_sub_original <- system_sub_original %>%
mutate(load = abs(Actual.Socket.load.W_interpolation) +
abs(Actual.Light.load.W_interpolation),
loss = Potential.PV.power.W -
Postive.Actual.Solar.Charger.Battery.Power.W_interpolation,
State.of.Charge.W_interpolation=State.of.Charge.W_interpolation*100/1954)
system_sub_original <- system_sub_original[,-c(8,12)] # Remove socket and light load
colnames(system_sub_original) <- c("streetlight","timeUse","month","E_p", "BM_SoC","SoC",
"PV","E_a","B_cp","B_dp","E_load","L_c")
# Calculate Total load (actual AC + actual light), capture loss (potential-E_a)
system_sub_interpolation <- system_sub_interpolation %>%
mutate(load = abs(Actual.Socket.load.W_interpolation) +
abs(Actual.Light.load.W_interpolation),
loss = Potential.PV.power.W -
Postive.Actual.Solar.Charger.Battery.Power.W_interpolation,
State.of.Charge.W_interpolation=State.of.Charge.W_interpolation*100/1954)
system_sub_interpolation <- system_sub_interpolation[,-c(8,12)] # Remove socket & light load
colnames(system_sub_interpolation) <- c("streetlight","timeUse","month","E_p", "BM_SoC","SoC",
"PV","E_a","B_cp","B_dp","E_load","L_c")
# Remove months July to Sep for SL7
system_sub_original <- system_sub_original[!(system_sub_original$streetlight=="SL7" &
(system_sub_original$month=="Jul" | system_sub_original$month=="Aug" |
system_sub_original$month=="Sep")),]
system_sub_interpolation <-
system_sub_interpolation[!(system_sub_interpolation$streetlight=="SL7" &
(system_sub_interpolation$month=="Jul" | system_sub_interpolation$month=="Aug" |
system_sub_interpolation$month=="Sep")),]
# Calculate typical values for each SL
system_sub_original <- gather(system_sub_original, id, value, 4:12)
system_typical_original <- system_sub_original %>%
group_by(streetlight, timeUse, id) %>% summarise(value=mean(value, na.rm=TRUE))
system_typical_original <- as.data.frame(system_typical_original)
system_typical_original <- spread(system_typical_original, id, value)
system_sub_interpolation <- gather(system_sub_interpolation, id, value, 4:12)
system_typical_interpolation <- system_sub_interpolation %>%
group_by(streetlight, timeUse, id) %>% summarise(value=mean(value, na.rm=TRUE))
system_typical_interpolation <- as.data.frame(system_typical_interpolation)
system_typical_interpolation <- spread(system_typical_interpolation, id, value)
# Plot typical values for each SL
plotTypical <- function(df) {
ggplot(df, aes(x=timeUse)) + geom_line(aes(y=B_cp/1000.0, color="B_cp", linetype="B_cp")) +
geom_line(aes(y=abs(B_dp)/1000.0, color="B_dp",linetype="B_dp")) +
geom_line(aes(y=E_a/1000.0, color="E_a",linetype="E_a")) +
geom_line(aes(y=E_load/1000.0, color="E_load",linetype="E_load")) +
geom_line(aes(y=E_p/1000.0, color="E_p",linetype="E_p")) +
geom_line(aes(y=L_c/1000.0, color="L_c",linetype="L_c")) +
scale_y_continuous(breaks= seq(0,0.25,0.05), sec.axis = sec_axis(~.*400, name = "State of Charge (%)")) +
labs(y="Power (kW)", x = "Time of day", colour="Parameter", linetype="Parameter") +
scale_x_continuous(breaks=seq(0,24,by=2)) + THEME
}
plotTypical(system_typical_interpolation[system_typical_interpolation$streetlight=="SL1",]) +
geom_line(aes(y = BM_SoC/400, color = "SoC",linetype="SoC")) +
labs(title="Actual typical day profile for Nepal SL1 between Jul 2019 and Mar 2020")
plotTypical(system_typical_interpolation[system_typical_interpolation$streetlight=="SL1",]) +
geom_line(aes(y = BM_SoC/400, color = "SoC",linetype="SoC"))
plotTypical(system_typical_interpolation[system_typical_interpolation$streetlight=="SL1",]) +
geom_line(aes(y = BM_SoC/400, color = "SoC",linetype="SoC"))
ggsave(here(plot_dir,"typical_day_sl1_imputed_interpolation.png"))
plotTypical(system_typical_interpolation[system_typical_interpolation$streetlight=="SL2",]) +
geom_line(aes(y = BM_SoC/400, color = "SoC",linetype="SoC"))
ggsave(here(plot_dir,"typical_day_sl2_imputed_interpolation.png"))
plotTypical(system_typical_interpolation[system_typical_interpolation$streetlight=="SL3",]) +
geom_line(aes(y = BM_SoC/400, color = "SoC",linetype="SoC"))
ggsave(here(plot_dir,"typical_day_sl3_imputed_interpolation.png"))
plotTypical(system_typical_interpolation[system_typical_interpolation$streetlight=="SL4",]) +
geom_line(aes(y = BM_SoC/400, color = "SoC",linetype="SoC"))
ggsave(here(plot_dir,"typical_day_sl4_imputed_interpolation.png"))
plotTypical(system_typical_interpolation[system_typical_interpolation$streetlight=="SL5",]) +
geom_line(aes(y = BM_SoC/400, color = "SoC",linetype="SoC"))
ggsave(here(plot_dir,"typical_day_sl5_imputed_interpolation.png"))
plotTypical(system_typical_interpolation[system_typical_interpolation$streetlight=="SL6",]) +
geom_line(aes(y = BM_SoC/400, color = "SoC",linetype="SoC"))
ggsave(here(plot_dir,"typical_day_sl6_imputed_interpolation.png"))
plotTypical(system_typical_interpolation[system_typical_interpolation$streetlight=="SL7",]) +
geom_line(aes(y = SoC/400, color = "SoC",linetype="SoC"))
ggsave(here(plot_dir,"typical_day_sl7_imputed_interpolation.png"))
#*****************************************************************************************#
# Box plots for Socket consumption
plotACLoad <- function(df) {
ggplot(df, aes(as.factor(timeUse), Actual.Socket.load.W_interpolation/1000.0)) +
geom_boxplot() + labs(x="Time of day", y="Socket consumption (kW)") + THEME
}
plotACLoad(na_seadec_correctedData[na_seadec_correctedData$streetlight=="SL1",]) +
labs(title="Hourly socket consumption at Nepal SL1 between Jul 2019 and Mar 2020")
# labs(title="Hourly socket consumption at Nepal SL1 between Jul 2019 and Mar 2020")
plotACLoad(na_seadec_correctedData[na_seadec_correctedData$streetlight=="SL1",]) +
labs(title="Hourly socket consumption at Nepal SL1 between Jul 2019 and Mar 2020")
# labs(title="Hourly socket consumption at Nepal SL1 between Jul 2019 and Mar 2020")
plotACLoad(na_seadec_correctedData[na_seadec_correctedData$streetlight=="SL1",])
ggsave(here(plot_dir,"acLoad_sl1_imputed.png"))
plotACLoad(na_seadec_correctedData[na_seadec_correctedData$streetlight=="SL2",])
ggsave(here(plot_dir,"acLoad_sl2_imputed.png"))
plotACLoad(na_seadec_correctedData[na_seadec_correctedData$streetlight=="SL3",])
ggsave(here(plot_dir,"acLoad_sl3_imputed.png"))
plotACLoad(na_seadec_correctedData[na_seadec_correctedData$streetlight=="SL4",])
ggsave(here(plot_dir,"acLoad_sl4_imputed.png"))
plotACLoad(na_seadec_correctedData[na_seadec_correctedData$streetlight=="SL5",])
ggsave(here(plot_dir,"acLoad_sl5_imputed.png"))
plotACLoad(na_seadec_correctedData[na_seadec_correctedData$streetlight=="SL6",])
ggsave(here(plot_dir,"acLoad_sl6_imputed.png"))
plotACLoad(na_seadec_correctedData[na_seadec_correctedData$streetlight=="SL7" &
na_seadec_correctedData$date>="2019-10-01",])
ggsave(here(plot_dir,"acLoad_sl7_imputed.png"))
# Plot across all select SL - except SL5 and SL7
# labs(title="Hourly socket consumption at Nepal SL1-4 and SL6 between Jul 2019 and Mar 2020")
plotACLoad(na_seadec_correctedData[!(na_seadec_correctedData$streetlight=="SL5" |
na_seadec_correctedData$streetlight=="SL7"),]) + THEME
ggsave(here(plot_dir,"acLoad_sl_all_nepal.png"))
# Create an avg SL for each date and hour considering SL1-4 and SL6
avgSL <- na_seadec_correctedData[!(na_seadec_correctedData$streetlight=="SL5" |
na_seadec_correctedData$streetlight=="SL7"),] %>%
group_by(date, timeUse) %>%
summarise(Actual.Socket.load.W_interpolation=mean(Actual.Socket.load.W_interpolation))
avgSL <- as.data.frame(avgSL)
# labs(title="Hourly socket consumption at average Nepal SL between Jul 2019 and Mar 2020")
plotACLoad(avgSL) + THEME
ggsave(here(plot_dir,"acLoad_avg_sl_nepal.png"))
# Avg socket load value across SL1-4 and SL6 against timeUse for all months
avgLoad <- na_seadec_correctedData[!(na_seadec_correctedData$streetlight=="SL5" |
na_seadec_correctedData$streetlight=="SL7"),] %>%
group_by(timeUse) %>%
summarise(Socket.load.kW = mean(Actual.Socket.load.W_interpolation)/1000.0)
write.csv(avgLoad, file=here(filepath,"avg_hourly_socketLoad_nepal.csv"), row.names=FALSE)
# PLot energy excess data
ggplot(energy_excess, aes(as.factor(timeUse), Excess.Electricity.at.Socket.kW)) +
geom_boxplot() + labs(x="Time of day", y="Excess electricity (kW)",
title="Excess electricity at Nepal streetlight sockets between Jul 2019 and Mar 2020") +
THEME + scale_y_continuous(breaks=seq(0,0.25,0.05))
# PLot energy excess data
# title="Excess electricity at Nepal streetlight sockets between Jul 2019 and Mar 2020"
ggplot(energy_excess, aes(as.factor(timeUse), Excess.Electricity.at.Socket.kW)) +
geom_boxplot() + labs(x="Time of day", y="Excess electricity (kW)") +
THEME + scale_y_continuous(breaks=seq(0,0.25,0.05))
ggsave(here(plot_dir,"excess_energy_nepal_sl.png"))
#******************************************************************************************#
# Define macros - theme for all plots
THEME <- theme(plot.title = element_text(size=12), legend.position = "bottom",
legend.key.size = unit(0.5, "cm"),
legend.margin = margin(t=0,r=0,b=0,l=0), panel.grid.major.y = element_line(colour="grey") ,
panel.grid.minor = element_blank(), panel.background = element_blank(),
axis.line = element_line(colour = "black"), axis.text = element_text(size=12),
axis.title = element_text(size=12))
#******************************************************************************************#
# Set working directory
filepath <- "Data"
plot_dir <- "Plots/Paper 7"
#******************************************************************************************#
# Read SL and weather data between July 2019 to March 2020
sl_nepal <- read_csv(here(filepath,"sl_all_raw_jul19_mar20.csv"), col_names = TRUE)
sl_nepal <- as.data.frame(sl_nepal[,seq_along(sl_nepal)])
sl_nepal <- sl_nepal %>% mutate(date=date(timestamp),
month=as.character(month(timestamp, label=TRUE, abbr=TRUE)),
timeUse = hour(timestamp),
Charged.energy.W = ifelse(System.overview.Battery.Power.W<0, 0,
System.overview.Battery.Power.W),
Discharged.energy.W = ifelse(System.overview.Battery.Power.W>0,0,
System.overview.Battery.Power.W))
weather_data <- read_csv(here(filepath,"weather_hourly_jul19_mar20.csv"), col_names = TRUE)
weather_data <- weather_data[,1:8]
weather_data <- gather(weather_data, "streetlight", "Potential_PV_power_W", 2:8)
weather_data$date <- date(weather_data$timestamp)
weather_data$timeUse <- hour(weather_data$timestamp)
weather_data <- weather_data[,-1] # Remove timestamp
weather_data <- weather_data[,c(1,3,4,2)] # Rearrange columns
#******************************************************************************************#
# Plot yield per hour for each day - freq of data collection changes in Oct 2019
sl_all <- gather(sl_nepal, "id", "value", c(3:8,12:13))
sl_qual <- sl_all %>% group_by(streetlight, date, timeUse, id) %>% summarise(count = length(unique(timestamp)))
sl_qual <- as.data.frame(sl_qual)
sl_qual <- sl_qual %>% mutate(count2 = ifelse(count<100, count, 100),
yield=ifelse(date>="2019-10-15" & timeUse>=12, count*100/60, count*100/4),
yield2 =ifelse(yield>100, 100, yield))
pal <- wes_palette("Zissou1", 100, type = "continuous")
plotYield <- function(df) {
ggplot(df, aes(date, timeUse)) + facet_wrap(~streetlight, nrow=2) + geom_tile(aes(fill = yield2)) +
scale_fill_gradientn(colours = pal, breaks=c(0,25,50,75,100)) +
scale_y_continuous(breaks=seq(0,24,by=4)) + xlab("X axis") + ylab("Y axis") +
labs(y="Time of day", x = "Day of study", fill="Yield (%)") + THEME +
guides(fill = guide_colorbar(barwidth = 15, barheight = 0.5))
}
plotYield(sl_qual[sl_qual$streetlight%in%unique(sl_qual$streetlight)[1:4] &
sl_qual$id=="System.overview.Battery.Power.W",]) +
labs(title="Yield per hour for Nepal SL1-4: 1 Jul 2019 - 31 Mar 2020")
# labs(title="Yield per hour for Nepal SL1-4: 1 Jul 2019 - 31 Mar 2020")
plotYield(sl_qual[sl_qual$streetlight%in%unique(sl_qual$streetlight)[1:4] &
sl_qual$id=="System.overview.Battery.Power.W",])
ggsave(here(plot_dir,"yield_hourly1.png"))
# labs(title="Yield per hour for Nepal SL5-7: 1 Jul 2019 - 31 Mar 2020")
plotYield(sl_qual[sl_qual$streetlight%in%unique(sl_qual$streetlight)[1:4] &
sl_qual$id=="System.overview.Battery.Power.W",])
ggsave(here(plot_dir,"yield_hourly2.png"))
# labs(title="Yield per hour for Nepal SL5-7: 1 Jul 2019 - 31 Mar 2020")
plotYield(sl_qual[sl_qual$streetlight%in%unique(sl_qual$streetlight)[5:7] &
sl_qual$id=="System.overview.Battery.Power.W",])
ggsave(here(plot_dir,"yield_hourly2.png"))
# labs(title="Yield per hour for Nepal SL1-4: 1 Jul 2019 - 31 Mar 2020")
plotYield(sl_qual[sl_qual$streetlight%in%unique(sl_qual$streetlight)[1:4] &
sl_qual$id=="System.overview.Battery.Power.W",])
ggsave(here(plot_dir,"yield_hourly1.png"))
# labs(title="Yield per hour for Nepal SL5-7: 1 Jul 2019 - 31 Mar 2020")
plotYield(sl_qual[sl_qual$streetlight%in%unique(sl_qual$streetlight)[5:7] &
sl_qual$id=="System.overview.Battery.Power.W",])
ggsave(here(plot_dir,"yield_hourly2.png"))
# labs(title="Yield per hour for Nepal streetlights: 1 Jul 2019 - 31 Mar 2020")
plotYield(sl_qual[sl_qual$id=="System.overview.Battery.Power.W",])
ggsave(here(plot_dir,"yield_hourly_all.png"))
setwd("~/github-kriti1717/Rwanda_SL/HEED_Rwanda_SL/Scripts")
#******************************************************************************************#
# Importing libraries
library(tidyverse)
library(lubridate)
library(wesanderson)
library(here)
#******************************************************************************************#
# Define macros - theme for all plots
THEME <- theme(plot.title = element_text(size=12), legend.position = "bottom",
legend.key.size = unit(0.5, "cm"),
legend.margin = margin(t=0,r=0,b=0,l=0), panel.grid.major.y = element_line(colour="grey") ,
panel.grid.minor = element_blank(), panel.background = element_blank(),
axis.line = element_line(colour = "black"), axis.text = element_text(size=12),
axis.title = element_text(size=12))
#******************************************************************************************#
# Set working directory
filepath <- "Data/Simulated_data"
output_dir <- "Data"
file_list <- list.files(here(filepath))
plot_dir <- "Plots/Paper 7"
#******************************************************************************************#
# Calculate variables needed
system <- read_csv(here(output_dir,"simulated_hourly_jul_mar.csv"), col_names=TRUE)
system_sub <- data.frame()
for(i in 1:2) {
df <- system[system$country==unique(system$country)[i],]
df <- df %>% mutate(E_p = `Generic flat plate PV Incident Solar kW/m2`*EFF[i],
B_cp = `Generic 1kWh Li-Ion Charge Power kW`,
B_dp = `Generic 1kWh Li-Ion Discharge Power kW`,
E_a = `Generic flat plate PV Power Output kW` - `Excess Electrical Production kW`,
E_load = `Total Electrical Load Served kW`, SoC=`Generic 1kWh Li-Ion State of Charge %`,
L_c=E_p-E_a)
df <- df[,c(1,3,11:17)]
system_sub <- rbind(system_sub, df)
}
# Subtract 0.0025 from E_load values
system_sub <- system_sub %>% mutate(E_load = E_load - 0.0025)
# Calculate typical data for each country
system_sub <- gather(system_sub,id, value, 3:9)
system_typical <- system_sub %>% group_by(country, timestamp, id) %>% summarise(value=mean(value, na.rm=TRUE))
system_typical <- as.data.frame(system_typical)
system_typical <- spread(system_typical, id, value)
# Plot typical values for Nepal and Rwanda
plotTypical <- function(df) {
ggplot(df, aes(x=timestamp)) + geom_line(aes(y=B_cp, color="B_cp", linetype="B_cp")) +
geom_line(aes(y=B_dp, color="B_dp",linetype="B_dp")) + geom_line(aes(y=E_a, color="E_a",linetype="E_a")) +
geom_line(aes(y=E_load, color="E_load",linetype="E_load")) + geom_line(aes(y=E_p, color="E_p",linetype="E_p")) +
geom_line(aes(y=L_c, color="L_c",linetype="L_c")) + geom_line(aes(y = SoC/400, color = "SoC",linetype="SoC"))+
scale_y_continuous(breaks= seq(0,0.25,0.05), sec.axis = sec_axis(~.*400, name = "State of Charge (%)")) +
labs(y="Power (kW)", x = "Time of day", colour="Parameter", linetype="Parameter") +
scale_x_continuous(breaks=seq(0,24,by=2)) + THEME
}
plotTypical(system_typical[system_typical$country=="Nepal",]) +
labs(title="Simulated typical day profile for Nepal SL between Jul 2019 and Mar 2020")
# labs(title="Simulated typical day profile for Nepal SL between Jul 2019 and Mar 2020")
plotTypical(system_typical[system_typical$country=="Nepal",])
ggsave(here(plot_dir,"typical_day_nepal_sl_sim.png"))
# labs(title="Simulated typical day profile for Rwanda SL between Jul 2019 and Mar 2020")
plotTypical(system_typical[system_typical$country=="Rwanda",])
ggsave(here(plot_dir,"typical_day_rwanda_sl_sim.png"))
#******************************************************************************************#
# Define macros - theme for all plots
THEME <- theme(plot.title = element_text(size=12), legend.position = "bottom",
legend.key.size = unit(0.5, "cm"),
legend.margin = margin(t=0,r=0,b=0,l=0), panel.grid.major.y = element_line(colour="grey") ,
panel.grid.minor = element_blank(), panel.background = element_blank(),
axis.line = element_line(colour = "black"), axis.text = element_text(size=12),
axis.title = element_text(size=12))
#******************************************************************************************#
# Set working directory
filepath <- "Data"
plot_dir <- "Plots/Paper 7"
#******************************************************************************************#
# Read SL and weather data between July to April
sl_all <- read.csv(here(filepath,"sl_all_raw.csv"), header = TRUE, stringsAsFactors = FALSE)
sl_all <- sl_all %>%
mutate(PV.power.W = Solar.Charger.PV.current * Solar.Charger.PV.voltage,
Charged.energy.W = ifelse(System.overview.Battery.Power.W<0, 0, System.overview.Battery.Power.W),
Discharged.energy.W = ifelse(System.overview.Battery.Power.W>0,0,System.overview.Battery.Power.W),
timestamp = as.POSIXct(timestamp, origin="1970-01-01",tz="GMT"),
date = date(timestamp), month=as.character(month(timestamp, label=TRUE, abbr=TRUE)),
timeUse = hour(timestamp))
sl_all <- sl_all[,-c(9:10)] # Remove PV current and PV voltage
sl_all <- distinct(sl_all)
# Subset data till 31st March 2020
sl_all <- sl_all[sl_all$date<="2020-03-31",]
weather_data <- read_csv(here(filepath,"weather_hourly_jul_mar.csv"), col_names = TRUE)
weather_data <- weather_data[,1:5]
weather_data <- gather(weather_data, "streetlight", "Potential_PV_power_W", 2:5)
weather_data$date <- date(weather_data$timestamp)
weather_data$timeUse <- hour(weather_data$timestamp)
weather_data <- weather_data[,-1] # Remove timestamp
weather_data <- weather_data[,c(1,3,4,2)] # Rearrange columns
weather_data <- weather_data[weather_data$date>="2019-07-01",] # Select data from 1st July
#******************************************************************************************#
# Plot number of values per hour for each day
sl_qual <- sl_all[,c(1,2,15,17,7,9,10,12)]
colnames(sl_qual) <- c(colnames(sl_qual)[1:4],"Solar battery power", "AC load", "Battery power",
"PV power")
sl_qual <- gather(sl_qual, "id", "value", 5:8)
sl_qual <- sl_qual %>% group_by(streetlight, date, timeUse, id) %>%
summarise(count = length(unique(timestamp)))
sl_qual <- as.data.frame(sl_qual)
sl_qual <- sl_qual %>% mutate(count2 = ifelse(count<100, count, 100),
yield=ifelse(date>="2019-08-05" & timeUse>=16, count*100/60, count*100/4),
yield2=ifelse(yield>100, 100, yield))
pal <- wes_palette("Zissou1", 100, type = "continuous")
ggplot(sl_qual[sl_qual$id=="Battery power",], aes(date, timeUse)) + facet_wrap(~streetlight, nrow=2) + geom_tile(aes(fill = yield2)) +
scale_fill_gradientn(colours = pal, breaks=c(0,25,50,75,100)) +
scale_y_continuous(breaks=seq(0,24,by=4)) + xlab("X axis") + ylab("Y axis") +
labs(y="Time of day", x = "Day of study", fill="Yield (%)",
title="Yield per hour for Rwanda streetlights: 1 Jul 2019 - 31 Mar 2020") + THEME +
guides(fill = guide_colorbar(barwidth = 15, barheight = 0.5))
# title="Yield per hour for Rwanda streetlights: 1 Jul 2019 - 31 Mar 2020"
ggplot(sl_qual[sl_qual$id=="Battery power",], aes(date, timeUse)) + facet_wrap(~streetlight, nrow=2) + geom_tile(aes(fill = yield2)) +
scale_fill_gradientn(colours = pal, breaks=c(0,25,50,75,100)) +
scale_y_continuous(breaks=seq(0,24,by=4)) + xlab("X axis") + ylab("Y axis") +
labs(y="Time of day", x = "Day of study", fill="Yield (%)") + THEME +
guides(fill = guide_colorbar(barwidth = 15, barheight = 0.5))
ggsave(here(plot_dir,"yield_hourly_all.png"))
#******************************************************************************************#
# Define macros - theme for all plots
THEME <- theme(plot.title = element_text(size=12), legend.position = "bottom",
legend.key.size = unit(0.5, "cm"),
legend.margin = margin(t=0,r=0,b=0,l=0), panel.grid.major.y = element_line(colour="grey") ,
panel.grid.minor = element_blank(), panel.background = element_blank(),
axis.line = element_line(colour = "black"), axis.text = element_text(size=12),
axis.title = element_text(size=12))
#******************************************************************************************#
# Set working directory
filepath <- "Data"
plot_dir <- "Plots/Paper 7"
#******************************************************************************************#
# Read data and calculate typical data values
na_seadec_correctedData <- read.csv(here(filepath,"na_seadec_correctedData.csv"), header=TRUE, stringsAsFactors=FALSE)
na_seadec_correctedData <- na_seadec_correctedData %>%
mutate(date=as.Date(date),timestamp=as.POSIXct(timestamp, tz="GMT", origin="1970-01-01"),
month2=factor(month, levels = c("Jul", "Aug", "Sep", "Oct", "Nov", "Dec", "Jan", "Feb", "Mar"),
labels = c("Jul", "Aug", "Sep", "Oct", "Nov", "Dec", "Jan", "Feb", "Mar")))
energy_excess <- read.csv(here(filepath,"Excess elc at sockets Rwanda 2.csv"), header=TRUE, stringsAsFactors=FALSE)
energy_excess <- energy_excess %>%
mutate(Time=as.POSIXct(Time, tz="GMT", origin="1970-01-01", format="%d/%m/%Y %H:%M"),
timeUse = hour(Time))
#******************************************************************************************#
# Get full data days from original data - all variables needed
system_sub_original <- na_seadec_correctedData[,c(1,2,3,9,18,12,21,25)]
system_sub_original <- system_sub_original[complete.cases(system_sub_original),]
onHours <- system_sub_original %>% group_by(streetlight, month2, date) %>%
summarise(hours=length(PV.power.W_original))
onHours <- as.data.frame(onHours[onHours$hours==24,])
full_days <- onHours %>% group_by(streetlight, month2) %>% summarise(days=length(date))
write.csv(full_days, file=here(filepath,"full_days_all_data_rwanda.csv"), row.names=FALSE)
# Get full data days from original data - all variables needed except AC load
system_sub_original <- na_seadec_correctedData[,c(1,2,3,9,12,21,25)]
system_sub_original <- system_sub_original[complete.cases(system_sub_original),]
onHours <- system_sub_original %>% group_by(streetlight, month2, date) %>%
summarise(hours=length(PV.power.W_original))
onHours <- as.data.frame(onHours[onHours$hours==24,])
full_days <- onHours %>% group_by(streetlight, month2) %>% summarise(days=length(date))
write.csv(full_days, file=here(filepath,"full_days_all_except_AC_rwanda.csv"), row.names=FALSE)
#******************************************************************************************#
# Get typical day values
# Subset data to get SL, Time, Potential PV, SoC, Actual PV power, Actual AC load,
# Positive actual Solar battery power (E_a), Positive and negative actual battery power,
# Actual light load
system_sub_kalman <- na_seadec_correctedData[,c(1,3,22,26,28,32,50,54,55,57)]
system_sub_interpolation <- na_seadec_correctedData[,c(1,3,22,27,29,33,48,52,53,59)]
# Calculate Total load (actual AC + actual light), capture loss (potential-actual PV), SoC=SoC*100/3072 - Kalman
system_sub_kalman <- system_sub_kalman %>%
mutate(load = abs(Actual.AC.consumption.W_kalman) + abs(Actual.Light.laod.W_kalman),
loss = Potential.PV.power.W - Postive.Actual.Solar.Charger.Battery.Power.W_kalman,
State.of.Charge.W_kalman=State.of.Charge.W_kalman*100/3072)
system_sub_kalman <- system_sub_kalman[,-c(6,10)] # Remove socket and light load
colnames(system_sub_kalman) <- c("streetlight","timeUse","E_p","SoC","PV","E_a",
"B_cp","B_dp","E_load","L_c")
# Calculate Total load (actual AC + actual light), capture loss (potential-actual PV), SoC=SoC*100/3072 - Interpolation
system_sub_interpolation <- system_sub_interpolation %>%
mutate(load = abs(Actual.AC.consumption.W_interpolation) + abs(Actual.Light.laod.W_interpolation),
loss = Potential.PV.power.W - Postive.Actual.Solar.Charger.Battery.Power.W_interpolation,
State.of.Charge.W_interpolation=State.of.Charge.W_interpolation*100/3072)
system_sub_interpolation <- system_sub_interpolation[,-c(6,10)] # Remove socket and light load
colnames(system_sub_interpolation) <- c("streetlight","timeUse","E_p","SoC","PV","E_a",
"B_cp","B_dp","E_load","L_c")
# Correct E_a value for SL3 - replace it with Actual PV* 0.94
system_sub_kalman <- system_sub_kalman %>%
mutate(E_a=ifelse(streetlight=="SL3", PV*0.94, E_a))
system_sub_interpolation <- system_sub_interpolation %>%
mutate(E_a=ifelse(streetlight=="SL3", PV*0.94, E_a))
# Calculate typical values for each SL
system_sub_kalman <- gather(system_sub_kalman, id, value, 3:10)
system_typical_kalman <- system_sub_kalman %>% group_by(streetlight, timeUse, id) %>%
summarise(value=mean(value, na.rm=TRUE))
system_typical_kalman <- as.data.frame(system_typical_kalman)
system_typical_kalman <- spread(system_typical_kalman, id, value)
system_sub_interpolation <- gather(system_sub_interpolation, id, value, 3:10)
system_typical_interpolation <- system_sub_interpolation %>% group_by(streetlight, timeUse, id) %>%
summarise(value=mean(value, na.rm=TRUE))
system_typical_interpolation <- as.data.frame(system_typical_interpolation)
system_typical_interpolation <- spread(system_typical_interpolation, id, value)
# Plot typical values for each SL
plotTypical <- function(df) {
ggplot(df, aes(x=timeUse)) + geom_line(aes(y=B_cp/1000.0, color="B_cp", linetype="B_cp")) +
geom_line(aes(y=abs(B_dp)/1000.0, color="B_dp",linetype="B_dp")) +
geom_line(aes(y=E_a/1000.0, color="E_a",linetype="E_a")) +
geom_line(aes(y=E_load/1000.0, color="E_load",linetype="E_load")) +
geom_line(aes(y=E_p/1000.0, color="E_p",linetype="E_p")) +
geom_line(aes(y=L_c/1000.0, color="L_c",linetype="L_c")) +
geom_line(aes(y = SoC/400, color = "SoC",linetype="SoC")) +
scale_y_continuous(breaks= seq(0,0.25,0.05), sec.axis = sec_axis(~.*400,
name = "State of Charge (%)")) +
labs(y="Power (kW)", x = "Time of day", colour="Parameter", linetype="Parameter") +
scale_x_continuous(breaks=seq(0,24,by=2)) + THEME
}
plotTypical(system_typical_interpolation[system_typical_interpolation$streetlight=="SL2",]) +
labs(title="Actual typical day profile for Rwanda SL2 between Jul 2019 and Mar 2020")
# labs(title="Actual typical day profile for Rwanda SL1 between Jul 2019 and Mar 2020")
plotTypical(system_typical_interpolation[system_typical_interpolation$streetlight=="SL1",])
ggsave(here(plot_dir,"typical_day_sl1_imputed_interpolation.png"))
plotTypical(system_typical_interpolation[system_typical_interpolation$streetlight=="SL2",])
ggsave(here(plot_dir,"typical_day_sl2_imputed_interpolation.png"))
plotTypical(system_typical_interpolation[system_typical_interpolation$streetlight=="SL3",])
ggsave(here(plot_dir,"typical_day_sl3_imputed_interpolation.png"))
plotTypical(system_typical_interpolation[system_typical_interpolation$streetlight=="SL4",])
ggsave(here(plot_dir,"typical_day_sl4_imputed_interpolation.png"))
#*****************************************************************************************#
# Box plots for Socket consumption
plotACLoad <- function(df) {
ggplot(df[df$date>"2019-07-19",], aes(as.factor(timeUse),
Actual.AC.consumption.W_interpolation/1000.0)) +
geom_boxplot() + labs(x="Time of day", y="Socket consumption (kW)") + THEME
}
# labs(title="Hourly socket consumption at Rwanda SL1 between Jul 2019 and Mar 2020")
plotACLoad(na_seadec_correctedData[na_seadec_correctedData$streetlight=="SL1",])
ggsave(here(plot_dir,"acLoad_sl1_rwanda.png"))
plotACLoad(na_seadec_correctedData[na_seadec_correctedData$streetlight=="SL2",])
ggsave(here(plot_dir,"acLoad_sl2_rwanda.png"))
plotACLoad(na_seadec_correctedData[na_seadec_correctedData$streetlight=="SL3",])
ggsave(here(plot_dir,"acLoad_sl3_rwanda.png"))
plotACLoad(na_seadec_correctedData[na_seadec_correctedData$streetlight=="SL4",])
ggsave(here(plot_dir,"acLoad_sl4_rwanda.png"))
# Plot across all SL
# title="Hourly socket consumption at Rwanda SL1-4 between Jul 2019 and Mar 2020"
plotACLoad(na_seadec_correctedData)
ggsave(here(plot_dir,"acLoad_sl_all_rwanda.png"))
# Create an avg SL for each date and hour
avgSL <- na_seadec_correctedData %>% group_by(date, timeUse) %>%
summarise(Actual.AC.consumption.W_interpolation=mean(Actual.AC.consumption.W_interpolation))
avgSL <- as.data.frame(avgSL)
# title="Hourly socket consumption at average Rwanda SL between Jul 2019 and Mar 2020"
plotACLoad(avgSL)
ggsave(here(plot_dir,"acLoad_avg_sl_rwanda.png"))
# Avg socket load value across all SL against timeUse for all months
avgLoad <- na_seadec_correctedData %>% group_by(timeUse) %>%
summarise(Socket.load.kW = mean(Actual.AC.consumption.W_interpolation)/1000.0)
write.csv(avgLoad, file=here(filepath,"avg_hourly_socketLoad_rwanda.csv"), row.names=FALSE)
# PLot energy excess data
ggplot(energy_excess, aes(as.factor(timeUse), Excess.Electricity.at.Sockets.kW)) +
geom_boxplot() + labs(x="Time of day", y="Excess electricity (kW)",
title="Excess electricity at Rwanda streetlight sockets between Jul 2019 and Mar 2020") +
THEME  + scale_y_continuous(breaks=seq(0,0.25,0.05), limits=c(0,0.25))
# PLot energy excess data
# title="Excess electricity at Rwanda streetlight sockets between Jul 2019 and Mar 2020"
ggplot(energy_excess, aes(as.factor(timeUse), Excess.Electricity.at.Sockets.kW)) +
geom_boxplot() + labs(x="Time of day", y="Excess electricity (kW)") +
THEME  + scale_y_continuous(breaks=seq(0,0.25,0.05), limits=c(0,0.25))
ggsave(here(plot_dir,"excess_energy_rwanda_sl.png"))
